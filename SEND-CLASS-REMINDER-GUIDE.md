# ğŸ”” HÆ°á»›ng dáº«n Gá»­i Nháº¯c Nhá»Ÿ Zalo cho Buá»•i Há»c

## ğŸ“‹ Tá»•ng quan

TÃ­nh nÄƒng gá»­i nháº¯c nhá»Ÿ tá»± Ä‘á»™ng qua Zalo cho há»c viÃªn khi sáº¯p tá»›i giá» há»c, giÃºp tÄƒng tá»· lá»‡ tham gia vÃ  Ä‘áº£m báº£o há»c viÃªn khÃ´ng bá» lá»¡ buá»•i há»c.

## ğŸ¯ TÃ­nh nÄƒng chÃ­nh

### 1. **Gá»­i nháº¯c nhá»Ÿ thá»§ cÃ´ng**
- GiÃ¡o viÃªn/Admin cÃ³ thá»ƒ gá»­i nháº¯c nhá»Ÿ cho táº¥t cáº£ há»c viÃªn trong lá»›p
- Tin nháº¯n Ä‘Æ°á»£c gá»­i qua Zalo OA
- Chá»‰ gá»­i cho há»c viÃªn Ä‘Ã£ káº¿t ná»‘i Zalo

### 2. **ThÃ´ng tin trong tin nháº¯n**
- ğŸ“š TÃªn lá»›p há»c
- ğŸ“ TiÃªu Ä‘á» buá»•i há»c
- â° Thá»i gian diá»…n ra
- â³ Thá»i gian cÃ²n láº¡i Ä‘áº¿n giá» há»c
- ğŸ“Œ Ghi chÃº buá»•i há»c (náº¿u cÃ³)

### 3. **Äiá»ƒm danh & ÄÃ¡nh giÃ¡**
- âœ… Äiá»ƒm danh há»c viÃªn
- ğŸ“ Nháº­n xÃ©t tá»«ng há»c viÃªn
- â­ ÄÃ¡nh giÃ¡ báº±ng sao (1-5 sao)
- ğŸ“Š BÃ¡o cÃ¡o buá»•i há»c

## ğŸš€ CÃ¡ch sá»­ dá»¥ng

### BÆ°á»›c 1: Truy cáº­p trang chi tiáº¿t buá»•i há»c

ÄÆ°á»ng dáº«n: `/classes/[id]/sessions/[sessionId]`

VÃ­ dá»¥: `http://localhost:3000/classes/1/sessions/1`

### BÆ°á»›c 2: Gá»­i nháº¯c nhá»Ÿ Zalo

1. **Chá»‰ giÃ¡o viÃªn/admin má»›i tháº¥y** card "Gá»­i nháº¯c nhá»Ÿ qua Zalo"
2. Click button **"Gá»­i nháº¯c nhá»Ÿ"**
3. Há»‡ thá»‘ng sáº½:
   - Láº¥y danh sÃ¡ch há»c viÃªn trong lá»›p
   - Lá»c nhá»¯ng há»c viÃªn Ä‘Ã£ cÃ³ Zalo ID
   - Táº¡o tin nháº¯n nháº¯c nhá»Ÿ
   - Gá»­i Ä‘á»“ng thá»i cho táº¥t cáº£ há»c viÃªn
   - Hiá»ƒn thá»‹ káº¿t quáº£ gá»­i

### Máº«u tin nháº¯n Ä‘Æ°á»£c gá»­i:

```
ğŸ”” NHáº®C NHá» BUá»”I Há»ŒC

ğŸ“š Lá»›p: Láº­p trÃ¬nh Web cÆ¡ báº£n
ğŸ“ Buá»•i há»c: Buá»•i 1 - Giá»›i thiá»‡u HTML/CSS
â° Thá»i gian: Thá»© TÆ°, 8 thÃ¡ng 1, 2026 20:00

â³ CÃ²n 2 giá» 15 phÃºt ná»¯a lÃ  Ä‘áº¿n giá» há»c!

ğŸ“Œ Ghi chÃº: Chuáº©n bá»‹ laptop vÃ  trÃ¬nh duyá»‡t Chrome
ğŸ’¡ HÃ£y chuáº©n bá»‹ sáºµn sÃ ng vÃ  tham gia Ä‘Ãºng giá» nhÃ©!

ChÃºc báº¡n há»c táº­p hiá»‡u quáº£! ğŸ“
```

### BÆ°á»›c 3: Äiá»ƒm danh há»c viÃªn

1. Chuyá»ƒn Ä‘áº¿n tab **"Äiá»ƒm Danh"**
2. ÄÃ¡nh dáº¥u tráº¡ng thÃ¡i cho tá»«ng há»c viÃªn:
   - âœ… CÃ³ máº·t (Present)
   - âŒ Váº¯ng máº·t (Absent)
   - â° Äi muá»™n (Late)
   - ğŸšª Vá» sá»›m (Early Leave)
3. Click **"LÆ°u"**

### BÆ°á»›c 4: Nháº­n xÃ©t há»c viÃªn

1. Chuyá»ƒn Ä‘áº¿n tab **"Nháº­n XÃ©t"**
2. Click **"Nháº­n XÃ©t"** bÃªn cáº¡nh tÃªn há»c viÃªn
3. Äiá»n:
   - â­ ÄÃ¡nh giÃ¡ báº±ng sao (1-5 sao)
   - ğŸ“ Nháº­n xÃ©t chi tiáº¿t
4. Click **"LÆ°u nháº­n xÃ©t"**

### BÆ°á»›c 5: BÃ¡o cÃ¡o buá»•i há»c

1. Chuyá»ƒn Ä‘áº¿n tab **"BÃ¡o CÃ¡o"**
2. Äiá»n thÃ´ng tin:
   - ğŸ“Š Tá»•ng káº¿t buá»•i há»c
   - ğŸ“ Ná»™i dung Ä‘Ã£ giáº£ng
   - ğŸ’¡ Ghi chÃº thÃªm
3. Click **"LÆ°u bÃ¡o cÃ¡o"**

## ğŸ“¡ API Endpoints

### POST `/api/class-sessions/[sessionId]/send-reminder`

Gá»­i nháº¯c nhá»Ÿ Zalo cho táº¥t cáº£ há»c viÃªn trong buá»•i há»c.

**Request:**
```bash
POST /api/class-sessions/1/send-reminder
```

**Response thÃ nh cÃ´ng:**
```json
{
  "success": true,
  "message": "ÄÃ£ gá»­i nháº¯c nhá»Ÿ thÃ nh cÃ´ng cho 15/20 há»c viÃªn",
  "sent": 15,
  "failed": 5,
  "failedStudents": ["Nguyá»…n VÄƒn A", "Tráº§n Thá»‹ B"],
  "totalStudents": 20
}
```

**Response lá»—i:**
```json
{
  "success": false,
  "error": "Session not found"
}
```

## âš™ï¸ YÃªu cáº§u ká»¹ thuáº­t

### 1. Há»c viÃªn pháº£i cÃ³ Zalo ID

Äá»ƒ nháº­n Ä‘Æ°á»£c nháº¯c nhá»Ÿ, há»c viÃªn cáº§n:
- ÄÃ£ follow Zalo OA cá»§a trÆ°á»ng
- ÄÃ£ Ä‘Æ°á»£c link Zalo ID trong há»‡ thá»‘ng

Kiá»ƒm tra báº±ng cÃ¡ch vÃ o **Quáº£n lÃ½ há»c viÃªn** â†’ Xem cá»™t "Zalo ID"

### 2. Zalo Token pháº£i há»£p lá»‡

Há»‡ thá»‘ng sá»­ dá»¥ng **Zalo Token Auto-Refresh** (xem `ZALO-TOKEN-AUTO-REFRESH.md`)

Token sáº½ tá»± Ä‘á»™ng refresh khi cÃ²n dÆ°á»›i 5 phÃºt.

### 3. Cáº¥u hÃ¬nh mÃ´i trÆ°á»ng

File `.env.local` cáº§n cÃ³:
```env
ZALO_OA_ID=<your_oa_id>
ZALO_APP_ID=<your_app_id>
ZALO_APP_SECRET=<your_app_secret>
ZALO_ACCESS_TOKEN=<your_access_token>
ZALO_REFRESH_TOKEN=<your_refresh_token>
```

## ğŸ¨ Giao diá»‡n

### Card Gá»­i Nháº¯c Nhá»Ÿ
- Gradient background: blue-50 â†’ purple-50
- Icon: BellRing (purple-600)
- Button: Gradient blue-600 â†’ purple-600
- Loading state vá»›i spinner animation
- Alert hiá»ƒn thá»‹ káº¿t quáº£ (success/error)

### Tabs Quáº£n lÃ½
1. **Äiá»ƒm Danh** - Checklist interactive
2. **Nháº­n XÃ©t** - Form vá»›i star rating
3. **BÃ¡o CÃ¡o** - Form tá»•ng káº¿t

## ğŸ”„ Tá»± Ä‘á»™ng hÃ³a (TÆ°Æ¡ng lai)

### LÃªn lá»‹ch gá»­i nháº¯c nhá»Ÿ tá»± Ä‘á»™ng

CÃ³ thá»ƒ táº¡o cron job Ä‘á»ƒ gá»­i tá»± Ä‘á»™ng:

```typescript
// app/api/cron/send-class-reminders/route.ts
export async function GET(req: NextRequest) {
  // Láº¥y táº¥t cáº£ buá»•i há»c sáº¯p diá»…n ra trong 2 giá» tá»›i
  const upcomingSessions = await db.query.classSessions.findMany({
    where: (sessions, { and, gte, lte }) => and(
      gte(sessions.scheduledAt, new Date()),
      lte(sessions.scheduledAt, new Date(Date.now() + 2 * 60 * 60 * 1000))
    ),
  });

  // Gá»­i reminder cho tá»«ng session
  for (const session of upcomingSessions) {
    await fetch(`/api/class-sessions/${session.id}/send-reminder`, {
      method: "POST",
    });
  }
}
```

Sau Ä‘Ã³ config trong Vercel/cron:
```json
{
  "crons": [{
    "path": "/api/cron/send-class-reminders",
    "schedule": "0 */2 * * *"
  }]
}
```

## ğŸ“Š Thá»‘ng kÃª & Monitoring

### Log format:

```
[Reminder] Sent to Nguyá»…n VÄƒn A (1234567890)
[Reminder] Failed to send to Tráº§n Thá»‹ B: Error: Invalid Zalo ID
[Reminder] Successfully sent 15/20 reminders for session #1
```

### Metrics cáº§n theo dÃµi:

- âœ… Tá»· lá»‡ gá»­i thÃ nh cÃ´ng
- âŒ Sá»‘ lÆ°á»£ng tháº¥t báº¡i
- ğŸ‘¥ Sá»‘ há»c viÃªn khÃ´ng cÃ³ Zalo ID
- â±ï¸ Thá»i gian xá»­ lÃ½

## ğŸ› Troubleshooting

### KhÃ´ng gá»­i Ä‘Æ°á»£c tin nháº¯n?

1. **Kiá»ƒm tra Zalo Token**
   ```bash
   curl http://localhost:3000/api/zalo/token-status
   ```

2. **Kiá»ƒm tra há»c viÃªn cÃ³ Zalo ID**
   - VÃ o trang quáº£n lÃ½ há»c viÃªn
   - Xem cá»™t "Zalo ID"
   - Náº¿u trá»‘ng â†’ Cáº§n link Zalo ID

3. **Xem logs**
   - Má»Ÿ Developer Console
   - Tab Network â†’ Xem response
   - Tab Console â†’ Xem error logs

### Má»™t sá»‘ há»c viÃªn khÃ´ng nháº­n Ä‘Æ°á»£c?

CÃ³ thá»ƒ do:
- Há»c viÃªn chÆ°a follow Zalo OA
- Zalo ID khÃ´ng chÃ­nh xÃ¡c
- Há»c viÃªn Ä‘Ã£ block OA
- Token khÃ´ng cÃ³ quyá»n gá»­i tin

Kiá»ƒm tra:
```bash
# Test gá»­i tin cho 1 há»c viÃªn cá»¥ thá»ƒ
curl -X POST http://localhost:3000/api/zalo/send-message \
  -H "Content-Type: application/json" \
  -d '{
    "zaloUserId": "1234567890",
    "message": "Test message"
  }'
```

## ğŸ” Báº£o máº­t

### Chá»‰ giÃ¡o viÃªn/admin Ä‘Æ°á»£c gá»­i

```typescript
// Trong page.tsx
{userRole && userRole !== "student" && (
  <Card className="mb-6 bg-gradient-to-r from-blue-50 to-purple-50">
    {/* Send reminder UI */}
  </Card>
)}
```

### API khÃ´ng cáº§n authentication (náº¿u cáº§n báº£o máº­t hÆ¡n)

ThÃªm middleware check role:

```typescript
// app/api/class-sessions/[sessionId]/send-reminder/route.ts
export async function POST(req: NextRequest, { params }) {
  // Check authentication
  const session = await getServerSession(authOptions);
  if (!session || session.user.role === 'student') {
    return NextResponse.json(
      { error: "Unauthorized" },
      { status: 401 }
    );
  }
  
  // ... rest of code
}
```

## ğŸ“š TÃ i liá»‡u liÃªn quan

- [Zalo Token Auto-Refresh](./ZALO-TOKEN-AUTO-REFRESH.md)
- [Zalo API v3.0 Migration](./ZALO-API-V3-MIGRATION.md)
- [Zalo Integration Guide](./ZALO-INTEGRATION-GUIDE.md)

---

**Táº¡o bá»Ÿi:** Antigravity AI Assistant  
**NgÃ y:** 2026-01-07  
**Version:** 1.0
